# Implementation Plan for opencode-notifier Issues

## Overview
This plan addresses 2 open GitHub issues:
- **Issue #24**: Document default settings more clearly
- **Issue #23**: Add icon support to notifications

---

## Issue #24: Default Settings Documentation

### Problem
Users are confused about what the default settings are, especially for desktop notifications.

### Solution
Add a dedicated "Default Settings" section to the README.md that explicitly lists all default values.

### Implementation

**File**: `README.md`

**Action**: Insert a new "Default Settings" section after the "Configuration" section (around line 124)

**Content to add**:
```markdown
### Default Settings

When no configuration file is present, these are the default values:

| Setting | Default | Description |
|---------|---------|-------------|
| `sound` | `true` | Sounds are enabled globally |
| `notification` | `true` | Notifications are enabled globally |
| `timeout` | `5` | Notification duration in seconds (Linux only) |
| `showProjectName` | `true` | Show project folder name in notification title |
| `events.permission.sound` | `true` | Sound for permission events |
| `events.permission.notification` | `true` | Notification for permission events |
| `events.complete.sound` | `true` | Sound for completion events |
| `events.complete.notification` | `true` | Notification for completion events |
| `events.subagent_complete.sound` | `false` | Sound for subagent completion |
| `events.subagent_complete.notification` | `false` | Notification for subagent completion |
| `events.error.sound` | `true` | Sound for error events |
| `events.error.notification` | `true` | Notification for error events |
| `events.question.sound` | `true` | Sound for question events |
| `events.question.notification` | `true` | Notification for question events |
```

**Verification**: 
1. Open README.md and confirm the new section appears after Configuration
2. Check that all default values match src/config.ts lines 48-84

---

## Issue #23: Add Icon Support to Notifications

### Problem
Users want to see the OpenCode icon in system notifications for better visual identification.

### Solution
Add icon configuration support and bundle OpenCode brand icons.

### Implementation Steps

#### Step 1: Download OpenCode Brand Icons

**Action**: Download the OpenCode brand icons from https://opencode.ai/brand

**Files to create**:
- `assets/icon-dark.png` - Dark mode icon
- `assets/icon-light.png` - Light mode icon

**Note**: If download is not possible, create a placeholder directory structure and document how users can add their own icons.

#### Step 2: Update Configuration Type Definitions

**File**: `src/config.ts`

**Action**: Add icon configuration to the NotifierConfig interface

**Changes**:
- Line 19-46: Add `icon` field to NotifierConfig interface
- Line 53-84: Add default icon paths
- Line 142-177: Update loadConfig to handle icon configuration

**Code changes**:
```typescript
// Add to NotifierConfig interface (around line 23)
icon: {
  path: string | null
  useBundled: boolean
}

// Add to DEFAULT_CONFIG (around line 57)
icon: {
  path: null,
  useBundled: true,
}

// Add to return object in loadConfig (around line 142)
icon: {
  path: userConfig.icon?.path ?? DEFAULT_CONFIG.icon.path,
  useBundled: userConfig.icon?.useBundled ?? DEFAULT_CONFIG.icon.useBundled,
}

// Add getter function at end of file
export function getIconPath(config: NotifierConfig): string | null {
  if (config.icon.path) {
    return config.icon.path
  }
  if (config.icon.useBundled) {
    // Return bundled icon based on platform
    return join(__dirname, '..', 'assets', 'icon.png')
  }
  return null
}
```

#### Step 3: Update Notification System

**File**: `src/notify.ts`

**Action**: Modify sendNotification to accept and use icon parameter

**Changes**:
- Line 23: Update function signature to accept icon parameter
- Line 52: Replace `icon: undefined` with actual icon path

**Code changes**:
```typescript
// Line 23: Update function signature
export async function sendNotification(
  title: string,
  message: string,
  timeout: number,
  iconPath?: string | null
): Promise<void> {

// Lines 48-52: Update notification options
const notificationOptions: any = {
  title: title,
  message: message,
  timeout: timeout,
  icon: iconPath || undefined,
}
```

#### Step 4: Update Main Plugin Entry Point

**File**: `src/index.ts`

**Action**: Pass icon path when sending notifications

**Changes**:
- Import getIconPath from config
- Pass icon path to sendNotification calls

**Code changes**:
```typescript
// Add import
import { getIconPath } from "./config"

// In notification calls, add icon parameter:
sendNotification(title, message, config.timeout, getIconPath(config))
```

#### Step 5: Update Documentation

**File**: `README.md`

**Action**: Add icon configuration documentation to the Configuration section

**Content to add after line 122**:
```markdown
### Icon

Customize the notification icon:

```json
{
  "icon": {
    "path": "/path/to/custom/icon.png",
    "useBundled": true
  }
}
```

| Option | Type | Default | Description |
|--------|------|---------|-------------|
| `icon.path` | string | `null` | Path to custom icon file |
| `icon.useBundled` | boolean | `true` | Use bundled OpenCode icon (ignored if `path` is set) |

**Note**: The bundled icon is used by default. Provide a custom `path` to override it.
```

---

## Build and Verification

### Build Commands
```bash
bun run build
bun run typecheck
```

### Verification Steps

1. **Test Issue #24**:
   - Read the updated README
   - Confirm default settings section is clear and accurate
   - Verify all default values match the code

2. **Test Issue #23**:
   - Build the plugin
   - Test on macOS: Run plugin and verify icon appears in notifications
   - Test on Linux: Verify icon appears in notify-send notifications
   - Test on Windows: Verify icon appears in Windows Toaster notifications
   - Test with custom icon path: Set `icon.path` and verify custom icon appears
   - Test with `icon.useBundled: false`: Verify no icon appears

---

## Files Modified

1. `README.md` - Add default settings documentation and icon configuration docs
2. `src/config.ts` - Add icon configuration support
3. `src/notify.ts` - Accept and use icon parameter
4. `src/index.ts` - Pass icon path to notifications
5. `assets/` - Create directory and add OpenCode brand icons (optional, can be documented as user-provided)

---

## Release Notes

When releasing this update:
- Bump version to 0.1.16
- Mention "Added icon support for notifications" 
- Mention "Improved documentation with default settings reference"
