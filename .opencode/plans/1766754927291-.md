# Plan: Fix suppressWhenFocused on Linux (Ghostty)

## Summary
Suppressing notifications when the terminal is focused fails on Arch Linux with Ghostty. The Linux focus detection uses X11 tools (xdotool/xprop) which can fail under Wayland. We need to capture actual active window info and extend detection accordingly.

## Goals
- Ensure `suppressWhenFocused` reliably detects Ghostty focus on Linux
- Support Wayland environments where `xdotool`/`xprop` fail
- Keep behavior no-op when detection tools are unavailable

## Implementation Plan
1) **Confirm config and cache**
   - `suppressWhenFocused` is enabled in `~/.config/opencode/opencode-notifier.json`
   - Clear cache so beta build is used: `~/.cache/opencode/node_modules/@mohak34/opencode-notifier`

2) **Collect Linux focus signals**
   - Gather active window info using X11 fallback (`xprop -root _NET_ACTIVE_WINDOW` then `xprop -id <id> WM_CLASS`).
   - Determine if Wayland is in use; if so, plan alternative detection commands.

3) **Extend Linux focus detection**
   - Update `getActiveWindowClassLinux()` to try additional Wayland-native tools when X11 tools fail.
   - Candidate commands (attempt in order, ignore failures):
     - `hyprctl activewindow -j` (Hyprland → read `class` or `initialClass`/`appId`)
     - `swaymsg -t get_tree` (Sway/wlroots → parse focused node `app_id`/`name`)
     - `gdbus call --session --dest org.gnome.Shell --object-path /org/gnome/Shell --method org.gnome.Shell.Eval ...` (GNOME Shell → focused app ID)
   - Normalize returned values and match against `detect-terminal` output using existing `matchesTerminal()`.

4) **Validate matching**
   - Confirm `detect-terminal` output for Ghostty and compare to WM_CLASS/app_id values.
   - If needed, add a small mapping table for known mismatches (e.g., Ghostty WM_CLASS vs app_id).

## Files to Modify
- `src/index.ts` (Linux focus detection, optional Wayland detection)
- `README.md` (update Linux requirements/tools if new commands are supported)

## Verification
- Rebuild: `bun run build`
- Clear cache and restart OpenCode
- With Ghostty focused, trigger notification and confirm it is suppressed
- With another app focused, confirm notifications fire normally
